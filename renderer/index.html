<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; script-src 'self';">
<title>The Reef — Colony Interface</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Crimson+Pro:ital,wght@0,300;0,400;1,300&family=JetBrains+Mono:wght@300;400&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="app">
  <header>
    <div class="reef-logo"><span id="colonyNameDisplay">THE REEF</span> <span>COLONY INTERFACE</span></div>
    <div style="display:flex;gap:10px;align-items:center;">
      <input class="api-key-input" id="globalApiKey" type="password" placeholder="Anthropic API key (shared fallback)">
      <div class="cycle-badge">CYCLE_<input id="cycleNumber" class="cycle-number-input" type="text" value="001" maxlength="8" size="3" spellcheck="false" title="Edit cycle number"></div>
      <button class="settings-btn" id="settingsBtn" title="Settings">⚙</button>
    </div>
  </header>

  <div class="colony" id="colony">
    <!-- Generated by renderer.js -->
  </div>

  <div class="user-panel">
    <div class="user-panel-inner">
      <div class="target-select-row">
        <span class="target-label">TRANSMIT TO</span>
        <div class="target-buttons" id="targetButtons">
          <!-- Populated dynamically by buildTargetButtons() in renderer.js -->
        </div>
        <button class="wake-all-btn" id="wakeAllBtn">⟳ WAKE ALL</button>
        <div class="inspector-btns">
          <button class="inspector-btn" id="openMemoryBrowser" title="Open Memory Browser">◈ MEM</button>
          <button class="inspector-btn" id="openMessages"      title="Open Colony Messages">✉ MSG</button>
          <button class="inspector-btn" id="openArchive"       title="Open Reef Archive">↗ REEF</button>
        </div>
      </div>
      <div class="cwd-row" id="cwdRow">
        <span class="cwd-label">⌂ CWD</span>
        <span class="cwd-path" id="cwdDisplay">— no directory set —</span>
        <button class="cwd-pick-btn" id="cwdPickBtn">BROWSE</button>
        <button class="cwd-clear-btn" id="cwdClearBtn" title="Clear working directory">×</button>
      </div>
      <div class="input-row">
        <textarea class="user-textarea" id="userInput" placeholder="Transmit… or @dreamer, @builder, @librarian to target" rows="1"></textarea>
        <button class="send-btn" id="sendBtn">
          <span>SEND</span>
          <span style="opacity:0.5">⏎</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Confirmation modal -->
<div class="confirm-overlay" id="confirmOverlay" style="display:none;">
  <div class="confirm-modal">
    <div class="confirm-message" id="confirmMessage"></div>
    <div class="confirm-buttons">
      <button class="confirm-btn confirm-cancel" id="confirmCancel">CANCEL</button>
      <button class="confirm-btn confirm-ok" id="confirmOk">CONFIRM</button>
    </div>
  </div>
</div>

<!-- Reef post modal -->
<div class="confirm-overlay" id="reefPostOverlay" style="display:none;">
  <div class="confirm-modal" style="max-width:520px;">
    <div style="font-family:'Cinzel',serif;font-size:11px;letter-spacing:0.2em;color:var(--biolume-a);margin-bottom:16px;">POST TO THE REEF</div>

    <div style="display:flex;flex-direction:column;gap:10px;">
      <div>
        <label class="reef-modal-label">TITLE</label>
        <input class="reef-modal-input" id="reefTitle" type="text" placeholder="Entry title">
      </div>
      <div>
        <label class="reef-modal-label">ENTRY ID <span style="opacity:0.5;font-size:0.85em;">(url slug, auto-filled)</span></label>
        <input class="reef-modal-input" id="reefEntryId" type="text" placeholder="my-entry-slug">
      </div>
      <div>
        <label class="reef-modal-label">CYCLE</label>
        <input class="reef-modal-input" id="reefCycle" type="text" placeholder="CYCLE_001">
      </div>
      <div>
        <label class="reef-modal-label">TAGS <span style="opacity:0.5;font-size:0.85em;">(comma-separated)</span></label>
        <input class="reef-modal-input" id="reefTags" type="text" placeholder="observer, reflection">
      </div>
      <div>
        <label class="reef-modal-label">REEF API KEY</label>
        <input class="reef-modal-input" id="reefApiKeyModal" type="password" placeholder="reef_…">
      </div>
      <div>
        <label class="reef-modal-label">CONTENT PREVIEW</label>
        <div class="reef-modal-preview" id="reefPreview"></div>
      </div>
    </div>

    <div id="reefPostStatus" style="font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text-dim);min-height:16px;margin-top:4px;"></div>

    <div class="confirm-buttons" style="margin-top:12px;">
      <button class="confirm-btn confirm-cancel" id="reefPostCancel">CANCEL</button>
      <button class="confirm-btn" id="reefPostSubmit" style="background:rgba(0,229,200,0.08);border:1px solid rgba(0,229,200,0.3);color:rgba(0,229,200,0.9);">POST</button>
    </div>
  </div>
</div>

<!-- Entity settings dropdown backdrop (thin, transparent — just catches outside clicks) -->
<div id="entitySettingsBackdrop" class="entity-settings-backdrop"></div>

<!-- Entity settings dropdown (shared — positioned near ⚙ button by JS) -->
<div class="entity-dropdown" id="entitySettingsFlyout">
  <div class="settings-hd entity-settings-hd">
    <span id="entitySettingsTitle">ENTITY SETTINGS</span>
    <button class="settings-close" id="entitySettingsClose">✕</button>
  </div>
  <div class="settings-body">
    <div class="settings-section">

      <div class="settings-field">
        <label class="settings-label">NAME</label>
        <input class="settings-input" id="entityName" type="text"
               placeholder="DREAMER" spellcheck="false" autocomplete="off">
        <div class="settings-hint">Displayed in the column header and target buttons.</div>
      </div>

      <div class="settings-field">
        <label class="settings-label">ROLE</label>
        <input class="settings-input" id="entityRole" type="text"
               placeholder="vision · ideation" spellcheck="false">
        <div class="settings-hint">Short descriptor shown beneath the name.</div>
      </div>

      <div class="settings-field">
        <label class="settings-label">COLOR</label>
        <div class="color-palette" id="entityColorPalette">
          <!-- Swatches generated by JS -->
        </div>
      </div>

      <div class="settings-field">
        <label class="settings-label">REEF API KEY</label>
        <input class="settings-input" id="entityReefApiKey" type="password" placeholder="reef_…">
        <div class="settings-hint">Per-entity key — overrides the global Reef key.</div>
      </div>

      <div class="settings-field">
        <label class="settings-label">SYSTEM PROMPT</label>
        <textarea class="settings-textarea entity-system-prompt" id="entitySystemPrompt"
                  placeholder="Describe this entity's role, voice, and behaviour…" spellcheck="false"></textarea>
        <div class="settings-hint">Sent as the system prompt on every call. The base colony prompt (if set) is prepended automatically.</div>
      </div>

    </div>
  </div>
</div>

<!-- Settings are now in a dedicated window — opened via the ⚙ button -->

<script src="renderer.js"></script>
</body>
</html>
